{"ast":null,"code":"import{useEffect,useState}from'react';import s from'./CommentsList.module.css';import{useMsal}from'@azure/msal-react';import{getPhotoUser}from'../../api/graph';import{loginRequest}from'../../authConfig';import UserInfoModalBtn from'../UserInfoModalBtn/UserInfoModalBtn';import{useSelector}from'react-redux';import{userSelector}from'../../selectors/userSelectors';import delteIcon from'../../assets/img/icons/delete-icon.svg';import{deleteNewsPost}from'../../api/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const toDay=new Date().toJSON().slice(0,10);const CommentsList=_ref=>{let{comment,fullScreen,uploadComments}=_ref;const{instance,accounts}=useMsal();let user=useSelector(userSelector.userData);let[commentsList,setCommentsList]=useState([]);function RequestProfilePhoto(id){return instance.acquireTokenSilent({...loginRequest,account:accounts[0]}).then(response=>{return getPhotoUser(response.accessToken,id).then(response=>{if(response){return response.blob();}else{return'';}}).then(result=>{const url=window.URL||window.webkitURL;const blobUrl=url.createObjectURL(result);if(result.type==='application/json'){return'';}return blobUrl;}).catch(error=>console.log(error));});}let findVisibleUsers=async array=>{let data=await Promise.all(array.map(async(item,index)=>{let imgUrl=await RequestProfilePhoto(item.usercode);return{...item,urlImg:imgUrl};}));setCommentsList(data);console.log(data);};useEffect(()=>{comment&&findVisibleUsers(comment);},[comment]);const onClickDeleteHandler=newsID=>{const deleteComment=async()=>{let result=await deleteNewsPost(newsID,user.id,'comments');if(result)uploadComments();};deleteComment();};return/*#__PURE__*/_jsxs(\"div\",{className:`${s.commets_container} ${fullScreen&&s.full_screen}`,children:[/*#__PURE__*/_jsx(\"p\",{className:s.commets_h,children:\"\\u041A\\u043E\\u043C\\u0435\\u043D\\u0442\\u0430\\u0440\\u0456:\"}),/*#__PURE__*/_jsx(\"ul\",{className:s.commets_list,children:commentsList&&commentsList.map((_ref2,index)=>{let{autor,post_date,comment_txt,urlImg,usercode,id}=_ref2;return/*#__PURE__*/_jsxs(\"li\",{className:`${s.commets_item}`,children:[user&&user.id===usercode&&/*#__PURE__*/_jsx(\"button\",{className:s.delete_btn,onClick:()=>onClickDeleteHandler(id),title:\"\\u0412\\u0438\\u0434\\u0438\\u043B\\u0438 \\u043A\\u043E\\u043C\\u0435\\u043D\\u0442\\u0430\\u0440\",children:/*#__PURE__*/_jsx(\"img\",{src:delteIcon,alt:\"\"})}),/*#__PURE__*/_jsx(UserInfoModalBtn,{userId:usercode,children:/*#__PURE__*/_jsxs(\"div\",{className:s.comment_user,children:[/*#__PURE__*/_jsx(\"img\",{src:urlImg,alt:\"\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:s.commets_title,children:autor&&autor}),/*#__PURE__*/_jsx(\"p\",{className:s.commets_date,children:post_date&&toDay===post_date.slice(0,10)?`Сьогодні ${post_date.slice(11,16)}`:`${post_date.slice(8,10)}-${post_date.slice(5,7)}-${post_date.slice(0,4)} ${post_date.slice(11,16)}`})]})]})}),/*#__PURE__*/_jsx(\"p\",{className:s.commets_text,children:comment_txt&&comment_txt})]},`comment${index}`);})})]});};export default CommentsList;","map":{"version":3,"names":["useEffect","useState","s","useMsal","getPhotoUser","loginRequest","UserInfoModalBtn","useSelector","userSelector","delteIcon","deleteNewsPost","jsx","_jsx","jsxs","_jsxs","toDay","Date","toJSON","slice","CommentsList","_ref","comment","fullScreen","uploadComments","instance","accounts","user","userData","commentsList","setCommentsList","RequestProfilePhoto","id","acquireTokenSilent","account","then","response","accessToken","blob","result","url","window","URL","webkitURL","blobUrl","createObjectURL","type","catch","error","console","log","findVisibleUsers","array","data","Promise","all","map","item","index","imgUrl","usercode","urlImg","onClickDeleteHandler","newsID","deleteComment","className","commets_container","full_screen","children","commets_h","commets_list","_ref2","autor","post_date","comment_txt","commets_item","delete_btn","onClick","title","src","alt","userId","comment_user","commets_title","commets_date","commets_text"],"sources":["C:/Users/zhuikov/OneDrive - SOFTCOM/Desktop/web/2024/korportal/src/components/CommentsList/CommentsList.jsx"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport s from './CommentsList.module.css';\r\nimport { useMsal } from '@azure/msal-react';\r\nimport { getPhotoUser } from '../../api/graph';\r\nimport { loginRequest } from '../../authConfig';\r\nimport UserInfoModalBtn from '../UserInfoModalBtn/UserInfoModalBtn';\r\nimport { useSelector } from 'react-redux';\r\nimport { userSelector } from '../../selectors/userSelectors';\r\nimport delteIcon from '../../assets/img/icons/delete-icon.svg';\r\nimport { deleteNewsPost } from '../../api/api';\r\n\r\nconst toDay = new Date().toJSON().slice(0, 10);\r\n\r\nconst CommentsList = ({ comment, fullScreen, uploadComments }) => {\r\n\tconst { instance, accounts } = useMsal();\r\n\tlet user = useSelector(userSelector.userData);\r\n\tlet [commentsList, setCommentsList] = useState([]);\r\n\r\n\tfunction RequestProfilePhoto(id) {\r\n\t\treturn instance\r\n\t\t\t.acquireTokenSilent({\r\n\t\t\t\t...loginRequest,\r\n\t\t\t\taccount: accounts[0],\r\n\t\t\t})\r\n\t\t\t.then((response) => {\r\n\t\t\t\treturn getPhotoUser(response.accessToken, id)\r\n\t\t\t\t\t.then((response) => {\r\n\t\t\t\t\t\tif (response) {\r\n\t\t\t\t\t\t\treturn response.blob();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treturn '';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then((result) => {\r\n\t\t\t\t\t\tconst url = window.URL || window.webkitURL;\r\n\t\t\t\t\t\tconst blobUrl = url.createObjectURL(result);\r\n\r\n\t\t\t\t\t\tif (result.type === 'application/json') {\r\n\t\t\t\t\t\t\treturn '';\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn blobUrl;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch((error) => console.log(error));\r\n\t\t\t});\r\n\t}\r\n\r\n\tlet findVisibleUsers = async (array) => {\r\n\t\tlet data = await Promise.all(\r\n\t\t\tarray.map(async (item, index) => {\r\n\t\t\t\tlet imgUrl = await RequestProfilePhoto(item.usercode);\r\n\t\t\t\treturn { ...item, urlImg: imgUrl };\r\n\t\t\t})\r\n\t\t);\r\n\t\tsetCommentsList(data);\r\n\t\tconsole.log(data);\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tcomment && findVisibleUsers(comment);\r\n\t}, [comment]);\r\n\r\n\tconst onClickDeleteHandler = (newsID) => {\r\n\t\tconst deleteComment = async () => {\r\n\t\t\tlet result = await deleteNewsPost(newsID, user.id, 'comments');\r\n\t\t\tif (result) uploadComments();\r\n\t\t};\r\n\t\tdeleteComment();\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div className={`${s.commets_container} ${fullScreen && s.full_screen}`}>\r\n\t\t\t<p className={s.commets_h}>Коментарі:</p>\r\n\t\t\t<ul className={s.commets_list}>\r\n\t\t\t\t{commentsList &&\r\n\t\t\t\t\tcommentsList.map(({ autor, post_date, comment_txt, urlImg, usercode, id }, index) => {\r\n\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t<li key={`comment${index}`} className={`${s.commets_item}`}>\r\n\t\t\t\t\t\t\t\t{user && user.id === usercode && (\r\n\t\t\t\t\t\t\t\t\t<button className={s.delete_btn} onClick={() => onClickDeleteHandler(id)} title=\"Видили коментар\">\r\n\t\t\t\t\t\t\t\t\t\t<img src={delteIcon} alt=\"\" />\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t<UserInfoModalBtn userId={usercode}>\r\n\t\t\t\t\t\t\t\t\t<div className={s.comment_user}>\r\n\t\t\t\t\t\t\t\t\t\t<img src={urlImg} alt=\"\" />\r\n\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<p className={s.commets_title}>{autor && autor}</p>\r\n\t\t\t\t\t\t\t\t\t\t\t<p className={s.commets_date}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{post_date && toDay === post_date.slice(0, 10)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t? `Сьогодні ${post_date.slice(11, 16)}`\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t: `${post_date.slice(8, 10)}-${post_date.slice(5, 7)}-${post_date.slice(0, 4)} ${post_date.slice(11, 16)}`}\r\n\t\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</UserInfoModalBtn>\r\n\t\t\t\t\t\t\t\t<p className={s.commets_text}>{comment_txt && comment_txt}</p>\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t})}\r\n\t\t\t</ul>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default CommentsList;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}