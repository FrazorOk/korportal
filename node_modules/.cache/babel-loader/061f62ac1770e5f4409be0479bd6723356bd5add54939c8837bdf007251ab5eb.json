{"ast":null,"code":"import{useEffect,useState}from'react';import DeleteButton from'../../../components/UI/DeleteButton/DeleteButton';import s from'./GalleryFilesFormSection.module.css';import{deleteGalleryCatalogsFiles,uploadFileInGallery}from'../../../api/api';import Loader from'../../../components/UI/Loader/Loader';import asseptIcon from'../../../assets/img/icons/assept-blue-icon.svg';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const GalleryFilesFormSection=_ref=>{let{files,Id,getCatalogFunction}=_ref;let[filesList,setFilesList]=useState([]);let[fetchingFiles,setFetchingFiles]=useState([]);let[inputFiles,setInputFiles]=useState([]);let[fetchingStatus,setFetchingStatus]=useState(true);async function processArray(array){for(let index=0;index<array.length;index++){let imgInArray=[array[index]];let result=await uploadFileInGallery(Id,imgInArray);if(result.id){setFetchingFiles(fetchingFilesList=>{let currentItem=[...fetchingFilesList];currentItem[index]={id:result.id,url:result.url,fetching:false,type:result.file_type};return currentItem;});}}}const onChangeInputFilesHandler=e=>{let filesListInput=e.target.files;if(filesListInput.length>0){let objectFetchingFile={isFetching:true,url:'',id:null,type:null};let currentArray=[];for(let index=0;index<filesListInput.length;index++){currentArray.push(objectFetchingFile);}setFetchingFiles(currentArray);setInputFiles(filesListInput);}};useEffect(()=>{files&&setFilesList(files);},[files]);useEffect(()=>{if(fetchingFiles.length>0&&inputFiles.length>0&&fetchingStatus){setFetchingStatus(false);setTimeout(()=>{processArray(inputFiles);},300);}},[fetchingFiles,inputFiles]);useEffect(()=>{if(fetchingFiles&&fetchingFiles.length>0){let allFetchedStatus=fetchingFiles.find(findItem=>findItem.fetching===true);console.log(allFetchedStatus);}},[fetchingFiles]);const onClickDeleteHandler=id=>{deleteGalleryCatalogsFiles(id,'files');};return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:s.files_list,children:[/*#__PURE__*/_jsxs(\"div\",{className:`${s.files_item} ${s.files_add_btn}`,children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"upload-files\"}),/*#__PURE__*/_jsx(\"input\",{id:\"upload-files\",type:\"file\",multiple:true,onChange:onChangeInputFilesHandler})]}),fetchingFiles&&fetchingFiles.map((file,indexFile)=>/*#__PURE__*/_jsx(\"div\",{className:`${s.files_item} ${s.files_fetching}`,children:file.isFetching?/*#__PURE__*/_jsx(Loader,{}):/*#__PURE__*/_jsx(\"img\",{className:s.assept_icon,src:asseptIcon,alt:\"\"})},indexFile)),filesList&&filesList.length>0&&filesList.map(file=>/*#__PURE__*/_jsxs(\"div\",{className:s.files_item,children:[/*#__PURE__*/_jsx(\"img\",{className:s.file_img,src:`${file.url}`,alt:\"\"}),/*#__PURE__*/_jsx(DeleteButton,{onClickHandler:()=>onClickDeleteHandler(file.id)})]},file.id))]})});};export default GalleryFilesFormSection;","map":{"version":3,"names":["useEffect","useState","DeleteButton","s","deleteGalleryCatalogsFiles","uploadFileInGallery","Loader","asseptIcon","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","GalleryFilesFormSection","_ref","files","Id","getCatalogFunction","filesList","setFilesList","fetchingFiles","setFetchingFiles","inputFiles","setInputFiles","fetchingStatus","setFetchingStatus","processArray","array","index","length","imgInArray","result","id","fetchingFilesList","currentItem","url","fetching","type","file_type","onChangeInputFilesHandler","e","filesListInput","target","objectFetchingFile","isFetching","currentArray","push","setTimeout","allFetchedStatus","find","findItem","console","log","onClickDeleteHandler","children","className","files_list","files_item","files_add_btn","htmlFor","multiple","onChange","map","file","indexFile","files_fetching","assept_icon","src","alt","file_img","onClickHandler"],"sources":["E:/web/web/2024/korportal/src/pages/AdminAddChangeGalleryPage/GalleryFilesFormSection/GalleryFilesFormSection.jsx"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport DeleteButton from '../../../components/UI/DeleteButton/DeleteButton';\r\nimport s from './GalleryFilesFormSection.module.css';\r\nimport { deleteGalleryCatalogsFiles, uploadFileInGallery } from '../../../api/api';\r\nimport Loader from '../../../components/UI/Loader/Loader';\r\nimport asseptIcon from '../../../assets/img/icons/assept-blue-icon.svg';\r\n\r\nconst GalleryFilesFormSection = ({ files, Id, getCatalogFunction }) => {\r\n\tlet [filesList, setFilesList] = useState([]);\r\n\tlet [fetchingFiles, setFetchingFiles] = useState([]);\r\n\tlet [inputFiles, setInputFiles] = useState([]);\r\n\tlet [fetchingStatus, setFetchingStatus] = useState(true);\r\n\r\n\tasync function processArray(array) {\r\n\t\tfor (let index = 0; index < array.length; index++) {\r\n\t\t\tlet imgInArray = [array[index]];\r\n\r\n\t\t\tlet result = await uploadFileInGallery(Id, imgInArray);\r\n\r\n\t\t\tif (result.id) {\r\n\t\t\t\tsetFetchingFiles((fetchingFilesList) => {\r\n\t\t\t\t\tlet currentItem = [...fetchingFilesList];\r\n\r\n\t\t\t\t\tcurrentItem[index] = {\r\n\t\t\t\t\t\tid: result.id,\r\n\t\t\t\t\t\turl: result.url,\r\n\t\t\t\t\t\tfetching: false,\r\n\t\t\t\t\t\ttype: result.file_type,\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\treturn currentItem;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tconst onChangeInputFilesHandler = (e) => {\r\n\t\tlet filesListInput = e.target.files;\r\n\r\n\t\tif (filesListInput.length > 0) {\r\n\t\t\tlet objectFetchingFile = { isFetching: true, url: '', id: null, type: null };\r\n\r\n\t\t\tlet currentArray = [];\r\n\t\t\tfor (let index = 0; index < filesListInput.length; index++) {\r\n\t\t\t\tcurrentArray.push(objectFetchingFile);\r\n\t\t\t}\r\n\t\t\tsetFetchingFiles(currentArray);\r\n\t\t\tsetInputFiles(filesListInput);\r\n\t\t}\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tfiles && setFilesList(files);\r\n\t}, [files]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (fetchingFiles.length > 0 && inputFiles.length > 0 && fetchingStatus) {\r\n\t\t\tsetFetchingStatus(false);\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tprocessArray(inputFiles);\r\n\t\t\t}, 300);\r\n\t\t}\r\n\t}, [fetchingFiles, inputFiles]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (fetchingFiles && fetchingFiles.length > 0) {\r\n\t\t\tlet allFetchedStatus = fetchingFiles.find((findItem) => findItem.fetching === true);\r\n\r\n\t\t\tconsole.log(allFetchedStatus);\r\n\t\t}\r\n\t}, [fetchingFiles]);\r\n\r\n\tconst onClickDeleteHandler = (id) => {\r\n\t\tdeleteGalleryCatalogsFiles(id, 'files');\r\n\t};\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<div className={s.files_list}>\r\n\t\t\t\t<div className={`${s.files_item} ${s.files_add_btn}`}>\r\n\t\t\t\t\t<label htmlFor=\"upload-files\"></label>\r\n\t\t\t\t\t<input id=\"upload-files\" type=\"file\" multiple onChange={onChangeInputFilesHandler}></input>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t{fetchingFiles &&\r\n\t\t\t\t\tfetchingFiles.map((file, indexFile) => (\r\n\t\t\t\t\t\t<div key={indexFile} className={`${s.files_item} ${s.files_fetching}`}>\r\n\t\t\t\t\t\t\t{file.isFetching ? <Loader /> : <img className={s.assept_icon} src={asseptIcon} alt=\"\" />}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t))}\r\n\r\n\t\t\t\t{filesList &&\r\n\t\t\t\t\tfilesList.length > 0 &&\r\n\t\t\t\t\tfilesList.map((file) => (\r\n\t\t\t\t\t\t<div key={file.id} className={s.files_item}>\r\n\t\t\t\t\t\t\t<img className={s.file_img} src={`${file.url}`} alt=\"\" />\r\n\t\t\t\t\t\t\t<DeleteButton onClickHandler={() => onClickDeleteHandler(file.id)} />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t))}\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n};\r\n\r\nexport default GalleryFilesFormSection;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}