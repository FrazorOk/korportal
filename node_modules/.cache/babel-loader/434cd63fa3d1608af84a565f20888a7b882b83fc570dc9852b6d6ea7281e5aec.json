{"ast":null,"code":"import{useEffect,useState}from'react';import DeleteButton from'../../../components/UI/DeleteButton/DeleteButton';import s from'./GalleryFilesFormSection.module.css';import{deleteGalleryCatalogsFiles,uploadFileInGallery}from'../../../api/api';import Loader from'../../../components/UI/Loader/Loader';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const GalleryFilesFormSection=_ref=>{let{files,Id}=_ref;let[filesList,setFilesList]=useState([]);let[fetchingFiles,setFetchingFiles]=useState([]);let[inputFiles,setInputFiles]=useState([]);let[fetchingStatus,setFetchingStatus]=useState(true);let[isIndexFetching,setIndexFetching]=useState(0);async function processArray(array){console.log(fetchingFiles);// for (let index = 0; index < array.length; index++) {\n// \tlet imgInArray = [array[index]];\n// \tconsole.log(array);\n// \tconsole.log(imgInArray);\n// \tsetTimeout(() => {\n// \t\tsetFetchingFiles((list) => {\n// \t\t\tlet currentList = [...list];\n// \t\t\tconsole.log(list);\n// \t\t\tconsole.log(currentList);\n// \t\t\tconsole.log(currentList[index]);\n// \t\t\tconsole.log(currentList[index].isFetching);\n// \t\t\tcurrentList[index].isFetching = false;\n// \t\t\treturn currentList;\n// \t\t});\n// \t}, 500);\n// let result = await uploadFileInGallery(Id, imgInArray);\n// console.log(result);\n// if (result.id) {\n// \tsetFetchingFiles((listFiles) => {\n// \t\tlet currentArray = [...listFiles];\n// \t\tconsole.log(currentArray);\n// \t\tconsole.log(index);\n// \t\tconsole.log(currentArray[index]);\n// \t\tif (currentArray[index]) {\n// \t\t\tcurrentArray[index].fetching = false;\n// \t\t\tcurrentArray[index].type = result.file_type;\n// \t\t\tcurrentArray[index].id = result.id;\n// \t\t\tcurrentArray[index].url = result.url;\n// \t\t\treturn currentArray;\n// \t\t}\n// \t});\n// }\n// }\nconsole.log('Done!');}// async function processArray(array) {\n// \tfor (const item of array) {\n// \t\tlet imgInArray = [item];\n// \t\tlet result = await uploadFileInGallery(Id, imgInArray);\n// \t\tconsole.log(result);\n// \t\tif (result.id) {\n// \t\t\tsetFetchingFiles((listFiles) => {\n// \t\t\t\tindexFile += 1;\n// \t\t\t\tlet currentArray = [...listFiles];\n// \t\t\t\tconsole.log(currentArray);\n// \t\t\t\tconsole.log(indexFile);\n// \t\t\t\tconsole.log(currentArray[indexFile]);\n// \t\t\t\tif (currentArray[indexFile]) {\n// \t\t\t\t\tcurrentArray[indexFile].fetching = false;\n// \t\t\t\t\tcurrentArray[indexFile].type = result.file_type;\n// \t\t\t\t\tcurrentArray[indexFile].id = result.id;\n// \t\t\t\t\tcurrentArray[indexFile].url = result.url;\n// \t\t\t\t\treturn currentArray;\n// \t\t\t\t}\n// \t\t\t});\n// \t\t}\n// \t}\n// \tconsole.log('Done!');\n// }\nconst onChangeInputFilesHandler=e=>{let filesListInput=e.target.files;if(filesListInput.length>0){let objectFetchingFile={isFetching:true,url:'',id:null,type:null};let currentArray=[];for(let index=0;index<filesListInput.length;index++){currentArray.push(objectFetchingFile);}setFetchingFiles(currentArray);setInputFiles(filesListInput);}};useEffect(()=>{files&&setFilesList(files);},[files]);useEffect(()=>{console.log(fetchingFiles);},[fetchingFiles]);useEffect(()=>{if(fetchingFiles.length>0&&inputFiles.length>0&&fetchingStatus){setFetchingStatus(false);processArray(inputFiles);}},[fetchingFiles,inputFiles]);const onClickDeleteHandler=id=>{deleteGalleryCatalogsFiles(id,'files');};return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:s.files_list,children:[/*#__PURE__*/_jsxs(\"div\",{className:`${s.files_item} ${s.files_add_btn}`,children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"upload-files\"}),/*#__PURE__*/_jsx(\"input\",{id:\"upload-files\",type:\"file\",multiple:true,onChange:onChangeInputFilesHandler})]}),fetchingFiles&&fetchingFiles.map((file,indexFile)=>/*#__PURE__*/_jsx(\"div\",{className:`${s.files_item} ${s.files_fetching}`,children:file.isFetching&&/*#__PURE__*/_jsx(Loader,{})},indexFile)),files&&files.length>0&&files.map(file=>/*#__PURE__*/_jsxs(\"div\",{className:s.files_item,children:[/*#__PURE__*/_jsx(\"img\",{className:s.file_img,src:`${file.url}`,alt:\"\"}),/*#__PURE__*/_jsx(DeleteButton,{onClickHandler:()=>onClickDeleteHandler(file.id)})]},file.id))]})});};export default GalleryFilesFormSection;","map":{"version":3,"names":["useEffect","useState","DeleteButton","s","deleteGalleryCatalogsFiles","uploadFileInGallery","Loader","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","GalleryFilesFormSection","_ref","files","Id","filesList","setFilesList","fetchingFiles","setFetchingFiles","inputFiles","setInputFiles","fetchingStatus","setFetchingStatus","isIndexFetching","setIndexFetching","processArray","array","console","log","onChangeInputFilesHandler","e","filesListInput","target","length","objectFetchingFile","isFetching","url","id","type","currentArray","index","push","onClickDeleteHandler","children","className","files_list","files_item","files_add_btn","htmlFor","multiple","onChange","map","file","indexFile","files_fetching","file_img","src","alt","onClickHandler"],"sources":["C:/Users/zhuikov/OneDrive - SOFTCOM/Desktop/web/2024/korportal/src/pages/AdminAddChangeGalleryPage/GalleryFilesFormSection/GalleryFilesFormSection.jsx"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport DeleteButton from '../../../components/UI/DeleteButton/DeleteButton';\r\nimport s from './GalleryFilesFormSection.module.css';\r\nimport { deleteGalleryCatalogsFiles, uploadFileInGallery } from '../../../api/api';\r\nimport Loader from '../../../components/UI/Loader/Loader';\r\n\r\nconst GalleryFilesFormSection = ({ files, Id }) => {\r\n\tlet [filesList, setFilesList] = useState([]);\r\n\tlet [fetchingFiles, setFetchingFiles] = useState([]);\r\n\tlet [inputFiles, setInputFiles] = useState([]);\r\n\tlet [fetchingStatus, setFetchingStatus] = useState(true);\r\n\tlet [isIndexFetching, setIndexFetching] = useState(0);\r\n\r\n\tasync function processArray(array) {\r\n\t\tconsole.log(fetchingFiles);\r\n\r\n\t\t// for (let index = 0; index < array.length; index++) {\r\n\t\t// \tlet imgInArray = [array[index]];\r\n\t\t// \tconsole.log(array);\r\n\t\t// \tconsole.log(imgInArray);\r\n\r\n\t\t// \tsetTimeout(() => {\r\n\t\t// \t\tsetFetchingFiles((list) => {\r\n\t\t// \t\t\tlet currentList = [...list];\r\n\r\n\t\t// \t\t\tconsole.log(list);\r\n\t\t// \t\t\tconsole.log(currentList);\r\n\t\t// \t\t\tconsole.log(currentList[index]);\r\n\t\t// \t\t\tconsole.log(currentList[index].isFetching);\r\n\r\n\t\t// \t\t\tcurrentList[index].isFetching = false;\r\n\r\n\t\t// \t\t\treturn currentList;\r\n\t\t// \t\t});\r\n\t\t// \t}, 500);\r\n\r\n\t\t// let result = await uploadFileInGallery(Id, imgInArray);\r\n\t\t// console.log(result);\r\n\r\n\t\t// if (result.id) {\r\n\t\t// \tsetFetchingFiles((listFiles) => {\r\n\t\t// \t\tlet currentArray = [...listFiles];\r\n\t\t// \t\tconsole.log(currentArray);\r\n\t\t// \t\tconsole.log(index);\r\n\t\t// \t\tconsole.log(currentArray[index]);\r\n\r\n\t\t// \t\tif (currentArray[index]) {\r\n\t\t// \t\t\tcurrentArray[index].fetching = false;\r\n\t\t// \t\t\tcurrentArray[index].type = result.file_type;\r\n\t\t// \t\t\tcurrentArray[index].id = result.id;\r\n\t\t// \t\t\tcurrentArray[index].url = result.url;\r\n\t\t// \t\t\treturn currentArray;\r\n\t\t// \t\t}\r\n\t\t// \t});\r\n\t\t// }\r\n\t\t// }\r\n\t\tconsole.log('Done!');\r\n\t}\r\n\r\n\t// async function processArray(array) {\r\n\t// \tfor (const item of array) {\r\n\t// \t\tlet imgInArray = [item];\r\n\r\n\t// \t\tlet result = await uploadFileInGallery(Id, imgInArray);\r\n\t// \t\tconsole.log(result);\r\n\r\n\t// \t\tif (result.id) {\r\n\t// \t\t\tsetFetchingFiles((listFiles) => {\r\n\t// \t\t\t\tindexFile += 1;\r\n\t// \t\t\t\tlet currentArray = [...listFiles];\r\n\t// \t\t\t\tconsole.log(currentArray);\r\n\t// \t\t\t\tconsole.log(indexFile);\r\n\t// \t\t\t\tconsole.log(currentArray[indexFile]);\r\n\r\n\t// \t\t\t\tif (currentArray[indexFile]) {\r\n\t// \t\t\t\t\tcurrentArray[indexFile].fetching = false;\r\n\t// \t\t\t\t\tcurrentArray[indexFile].type = result.file_type;\r\n\t// \t\t\t\t\tcurrentArray[indexFile].id = result.id;\r\n\t// \t\t\t\t\tcurrentArray[indexFile].url = result.url;\r\n\t// \t\t\t\t\treturn currentArray;\r\n\t// \t\t\t\t}\r\n\t// \t\t\t});\r\n\t// \t\t}\r\n\t// \t}\r\n\t// \tconsole.log('Done!');\r\n\t// }\r\n\r\n\tconst onChangeInputFilesHandler = (e) => {\r\n\t\tlet filesListInput = e.target.files;\r\n\r\n\t\tif (filesListInput.length > 0) {\r\n\t\t\tlet objectFetchingFile = { isFetching: true, url: '', id: null, type: null };\r\n\r\n\t\t\tlet currentArray = [];\r\n\t\t\tfor (let index = 0; index < filesListInput.length; index++) {\r\n\t\t\t\tcurrentArray.push(objectFetchingFile);\r\n\t\t\t}\r\n\t\t\tsetFetchingFiles(currentArray);\r\n\t\t\tsetInputFiles(filesListInput);\r\n\t\t}\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tfiles && setFilesList(files);\r\n\t}, [files]);\r\n\r\n\tuseEffect(() => {\r\n\t\tconsole.log(fetchingFiles);\r\n\t}, [fetchingFiles]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (fetchingFiles.length > 0 && inputFiles.length > 0 && fetchingStatus) {\r\n\t\t\tsetFetchingStatus(false);\r\n\t\t\tprocessArray(inputFiles);\r\n\t\t}\r\n\t}, [fetchingFiles, inputFiles]);\r\n\r\n\tconst onClickDeleteHandler = (id) => {\r\n\t\tdeleteGalleryCatalogsFiles(id, 'files');\r\n\t};\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<div className={s.files_list}>\r\n\t\t\t\t<div className={`${s.files_item} ${s.files_add_btn}`}>\r\n\t\t\t\t\t<label htmlFor=\"upload-files\"></label>\r\n\t\t\t\t\t<input id=\"upload-files\" type=\"file\" multiple onChange={onChangeInputFilesHandler}></input>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t{fetchingFiles &&\r\n\t\t\t\t\tfetchingFiles.map((file, indexFile) => (\r\n\t\t\t\t\t\t<div key={indexFile} className={`${s.files_item} ${s.files_fetching}`}>\r\n\t\t\t\t\t\t\t{file.isFetching && <Loader />}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t))}\r\n\r\n\t\t\t\t{files &&\r\n\t\t\t\t\tfiles.length > 0 &&\r\n\t\t\t\t\tfiles.map((file) => (\r\n\t\t\t\t\t\t<div key={file.id} className={s.files_item}>\r\n\t\t\t\t\t\t\t<img className={s.file_img} src={`${file.url}`} alt=\"\" />\r\n\t\t\t\t\t\t\t<DeleteButton onClickHandler={() => onClickDeleteHandler(file.id)} />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t))}\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n};\r\n\r\nexport default GalleryFilesFormSection;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}